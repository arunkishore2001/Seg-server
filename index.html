<script>
async function processLinks() {
    const links = document.getElementById('inputLinks').value
        .split('\n')
        .map(l => l.trim())
        .filter(Boolean);

    if (!links.length) {
        alert("Please enter some links");
        return;
    }

    document.getElementById("results").innerHTML = "";
    document.getElementById("progressBar").style.width = "0%";

    const rhsSet = new Set();
    const scrollSet = new Set();
    const notPresentSet = new Set();
    const notFoundSet = new Set(); // ✅ NEW

    let completed = 0;

    await Promise.allSettled(
        links.map(async (link) => {
            try {
                const res = await fetch("/api/check?url=" + encodeURIComponent(link));
                const data = await res.json();

                // ✅ 404 handling
                if (data.status === 404) {
                    notFoundSet.add(link);
                    return;
                }

                // ❌ skip empty / blocked pages
                if (!data.html) {
                    notPresentSet.add(link);
                    return;
                }

                const doc = new DOMParser().parseFromString(data.html, "text/html");

                const hasRhs = doc.querySelector(".rhs-cont");
                const hasScroll = doc.querySelector("#scroll");

                if (hasRhs) rhsSet.add(link);
                if (hasScroll) scrollSet.add(link);

                if (!hasRhs && !hasScroll) {
                    notPresentSet.add(link);
                }

            } catch {
                notPresentSet.add(link + " (⚠️ Error)");
            } finally {
                completed++;
                document.getElementById("progressBar").style.width =
                    Math.round((completed / links.length) * 100) + "%";
            }
        })
    );

    renderSimpleBlock("rhs-cont", [...rhsSet]);
    renderSimpleBlock("scroll", [...scrollSet]);
    renderSimpleBlock("404 not found", [...notFoundSet]); 
    renderSimpleBlock("not present", [...notPresentSet]);
}

/* ---------- UI helpers ---------- */

function renderSimpleBlock(title, links) {
    if (!links.length) return;

    const block = document.createElement("div");
    block.className = "block";

    block.innerHTML = `
        <h3>${title}
            <button onclick="copyDynamic(this)">Copy</button>
        </h3>
        <pre>${links.join("\n")}</pre>
    `;
    document.getElementById("results").appendChild(block);
}

function copyDynamic(btn) {
    const text = btn.closest(".block").querySelector("pre").textContent;
    navigator.clipboard.writeText(text).then(() => {
        alert("Copied!");
    });
}
</script>
