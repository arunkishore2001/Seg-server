<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Website Class Checker</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 150px; }
    .block { border: 1px solid #ccc; padding: 10px; margin-top: 15px; border-radius: 5px; }
    .block h3 { margin-top: 0; display: flex; justify-content: space-between; align-items: center; }
    button { padding: 5px 10px; }
    pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
    .result-row {
        display: flex;
        justify-content: space-between;
        padding: 6px 10px;
        border-bottom: 1px solid #ddd;
        font-size: 14px;
    }
    .result-row:nth-child(even) {
        background: #fafafa;
    }
    .url { font-weight: bold; }
    .status { font-style: italic; }
</style>
</head>
<body>

<h2>Website Class Sorter (Live Check)</h2>
<textarea id="inputLinks" placeholder="Paste your links here (one per line)"></textarea><br>
<button onclick="processLinks()">Process</button>
<div style="margin-top:20px;">
    <div style="background:#eee; border-radius:5px; height:20px; width:100%; margin-bottom:10px;">
        <div id="progressBar" style="background:#4caf50; height:100%; width:0%; border-radius:5px;"></div>
    </div>
    <div id="results"></div>
</div>

<div id="rhsContBlock" class="block" style="display:none;">
    <h3>rhs-cont <button onclick="copyBlock('rhsContLinks')">Copy</button></h3>
    <pre id="rhsContLinks"></pre>
</div>

<div id="testimonialBlock" class="block" style="display:none;">
    <h3>Testimonial <button onclick="copyBlock('testimonialLinks')">Copy</button></h3>
    <pre id="testimonialLinks"></pre>
</div>

<div id="noLhsBlock" class="block" style="display:none;">
    <h3>no lhs <button onclick="copyBlock('noLhsLinks')">Copy</button></h3>
    <pre id="noLhsLinks"></pre>
</div>

<div id="notPresentBlock" class="block" style="display:none;">
    <h3>not present <button onclick="copyBlock('notPresentLinks')">Copy</button></h3>
    <pre id="notPresentLinks"></pre>
</div>

<script>
async function processLinks() {
    const links = document.getElementById('inputLinks').value.split('\n').map(l => l.trim()).filter(Boolean);
    if (!links.length) {
        alert("Please enter some links");
        return;
    }

    ["rhsCont", "testimonial", "noLhs", "notPresent"].forEach(id => {
        document.getElementById(id + "Block").style.display = "none";
        document.getElementById(id + "Links").textContent = "";
    });
    document.getElementById("progressBar").style.width = "0%";

    let rhsCont = [];
    let testimonial = [];
    let noLhs = [];
    let notPresent = [];
    let completed = 0;

    const fetchPromises = links.map(async (link) => {
        try {
            const proxyUrl = "/api/check?url=" + encodeURIComponent(link);
            const res = await fetch(proxyUrl);
            const html = await res.text();

            const hasRhs = html.includes('class="rhs-cont"') || html.includes("class='rhs-cont'");
            const hasTestimonial = html.includes('class="apm-testimonial-section"') || html.includes("class='apm-testimonial-section'");
            const hasScroll = html.includes('id="scroll"') || html.includes("id='scroll'");

            if (hasRhs && hasTestimonial) {
                testimonial.push(link);
            } else if (hasRhs) {
                rhsCont.push(link);
            } else if (hasScroll) {
                noLhs.push(link);
            } else {
                notPresent.push(link);
            }
        } catch (err) {
            notPresent.push(link + " (⚠️ Error)");
        } finally {
            completed++;
            const percent = Math.round((completed / links.length) * 100);
            document.getElementById("progressBar").style.width = percent + "%";
        }
    });

    await Promise.allSettled(fetchPromises);

    updateBlock('rhsContBlock', 'rhsContLinks', rhsCont);
    updateBlock('testimonialBlock', 'testimonialLinks', testimonial);
    updateBlock('noLhsBlock', 'noLhsLinks', noLhs);
    updateBlock('notPresentBlock', 'notPresentLinks', notPresent);
}

function updateBlock(blockId, linksId, links) {
    const block = document.getElementById(blockId);
    const pre = document.getElementById(linksId);
    if (links.length) {
        block.style.display = 'block';
        pre.textContent = links.join('\n');
    } else {
        block.style.display = 'none';
        pre.textContent = '';
    }
}

function copyBlock(id) {
    const text = document.getElementById(id).textContent;
    if (!text) return;
    navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
    });
}
</script>

</body>
</html>
